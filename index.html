<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>串口助手</title>
    <link rel="stylesheet" href="./styles.css" />
</head>

<body>
    <div id="app">
        <aside id="sidebar" class="open">
            <div class="sidebar-header">
                <button id="toggleSidebar">≡</button>
                <span>串口窗口</span>
            </div>
            <div class="sidebar-actions">
                <button id="btnNew">新建面板</button>
                <button id="btnRefreshPorts">刷新串口</button>
            </div>
            <ul id="panelList"></ul>
            <div class="sidebar-footer">
                <button id="btnSettings">设置</button>
            </div>

        </aside>

        <main id="workspace">
            <div id="panes"></div>
        </main>

        <div id="bottomPanel">
            <div id="bottomNav">
                <button data-page="serial">串口</button>
                <button data-page="commands">命令</button>
                <button data-page="about">关于</button>
            </div>

            <div id="bottomContent">
                <div class="page" id="page-serial">
                    <div class="row">
                        <label>当前面板：</label>
                        <span id="activePanelLabel">（未选择）</span>
                        <button id="btnAddNote">添加备注</button>
                        <button id="btnSaveLog">导出面板数据</button>
                    </div>
                    <div class="row">
                        <label>波特率：</label>
                        <input id="baud" type="number" value="115200" min="110" step="1" />
                        <label>数据位：</label>
                        <select id="databits">
                            <option>8</option>
                            <option>7</option>
                            <option>6</option>
                            <option>5</option>
                        </select>
                        <label>停止位：</label>
                        <select id="stopbits">
                            <option>1</option>
                            <option>2</option>
                        </select>
                        <label>校验：</label>
                        <select id="parity">
                            <option value="none">none</option>
                            <option value="even">even</option>
                            <option value="odd">odd</option>
                            <option value="mark">mark</option>
                            <option value="space">space</option>
                        </select>
                    </div>
                    <div class="row" id="row-send-main">
                        <label>发送：</label>
                        <input id="inputData" type="text" placeholder="输入要发送的数据…" />
                        <button id="btnSend">发送</button>
                        <label><input type="checkbox" id="echoSend"> 回显</label>
                    </div>

                    <div class="row" id="row-send-opts">
                        <select id="append">
                            <option value="CRLF">CRLF</option>
                            <option value="none">无结尾</option>
                            <option value="CR">CR</option>
                            <option value="LF">LF</option>
                        </select>
                        <label>缓冲(ms):</label>
                        <input id="bufferTime" type="number" value="50" min="0" step="1" style="width:80px" />
                        <label><input type="checkbox" id="hexMode"> HEX发送</label>
                    </div>

                    <div class="row">
                        <label>文件：</label>
                        <input id="fileName" type="text" placeholder="拖拽文件到此处…" readonly />
                        <input id="fileChooser" type="file" style="display:none" />
                        <button id="btnChooseFile">选择文件</button>
                        <button id="btnSendFile">发送文件</button>
                    </div>
                </div>

                <div class="page" id="page-commands" style="display:none">
                    <div class="cmd-layout">
                        <div id="cmdGrid" class="cmd-grid"></div>
                        <div id="cmdTools" class="cmd-tools">
                            <div class="pager">
                                <button id="cmdPrev" title="上一页">◀</button>
                                <button id="cmdNext" title="下一页">▶</button>
                            </div>
                            <button id="cmdEditPage">编辑命令</button>
                            <button id="openScript">脚本发送</button>
                            <div class="repeat">
                                <label><input type="checkbox" id="cmdRepeat"> 定时发送</label>
                            </div>
                            <div class="repeat">
                                <input id="cmdRepeatMs" type="number" min="1" step="1" value="1000" />
                                <div class="note">ms</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-about" style="display:none">
                    <h3>About</h3>
                    <p>作者：Satone</p>
                    <p>
                        项目主页：
                        <a href="https://github.com/tylhk/SAEcom"
                            onclick="window.api.shell.openExternal(this.href); return false;">
                            https://github.com/tylhk/SAEcom
                        </a>
                    </p>
                    <p>
                        联系邮箱：
                        <a href="mailto:satone_shichimiya@outlook.com"
                            onclick="window.api.shell.openExternal(this.href); return false;">
                            satone_shichimiya@outlook.com
                        </a>
                    </p>
                    <p>
                        项目讨论页：
                        <a href="https://satone1008.cn/index.php/2025/09/16/%e6%94%af%e6%8c%81%e5%a4%9a%e7%aa%97%e5%8f%a3%e7%9b%91%e8%a7%86%e7%9a%84%e4%b8%b2%e5%8f%a3%e5%8a%a9%e6%89%8bsaecom/"
                            onclick="window.api.shell.openExternal(this.href); return false;">
                            博客链接
                        </a>
                    </p>
                </div>

            </div>
        </div>

        <dialog id="dlgNew">
            <h3>创建面板</h3>

            <!-- 串口模式 -->
            <div id="serialFields">
                <select id="dlgPortList" style="width:100%"></select>
            </div>

            <!-- TCP 模式 -->
            <div id="tcpFields" style="display:none;">
                <div class="row">
                    <label style="min-width:90px;">服务器地址：</label>
                    <input id="tcpHost" placeholder="例如 127.0.0.1 或 demo.server.com" style="flex:1;">
                </div>
                <div class="row" style="margin-top:6px;">
                    <label style="min-width:90px;">端口：</label>
                    <input id="tcpPort" type="number" min="1" max="65535" value="502" style="width:160px;">
                </div>
            </div>

            <div class="dlg-actions">
                <label class="tcp-switch"><input id="useTcp" type="checkbox"> 使用 TCP 连接</label>
                <div class="right">
                    <button id="dlgCancel">取消</button>
                    <button id="dlgCreate">创建</button>
                </div>
            </div>
        </dialog>

        <dialog id="dlgCmdEdit">
            <h3>编辑命令</h3>
            <div class="cmd-table-wrap">
                <table class="cmd-table">
                    <thead>
                        <tr>
                            <th class="drag" style="width:36px;">序</th>
                            <th class="sel" style="width:44px;">
                                <input id="cmdSelectAll" type="checkbox" title="全选/全不选">
                            </th>
                            <th>名称</th>
                            <th>内容</th>
                            <th style="width:96px;">模式</th>
                            <th style="width:96px;">操作</th>
                        </tr>
                    </thead>
                    <tbody id="cmdTableBody"></tbody>
                </table>
            </div>
            <div class="cmd-edit-actions">
                <button id="cmdAdd">新增命令</button>
                <span style="flex:1"></span>
                <button id="cmdDeleteSel">删除选中</button>
                <button id="cmdCancel">取消</button>
                <button id="cmdSave">保存</button>
            </div>
        </dialog>

        <dialog id="dlgScript">
            <h3>脚本页</h3>
            <div class="script-layout">
                <textarea id="scriptEditor" placeholder="在此编写脚本（.js）" spellcheck="false"></textarea>

                <div class="script-side">
                    <div class="script-row">
                        <button id="btnScriptNew">创建脚本</button>
                        <button id="btnScriptSave">保存脚本</button>
                        <button id="btnScriptDelete">删除脚本</button>
                    </div>
                    <div class="hint">当前文件：<span id="currentScriptName">（未选中）</span></div>
                    <div class="script-list-wrap">
                        <div class="hint">脚本目录：<span id="scriptDirHint"></span></div>
                        <ul id="scriptList"></ul>
                    </div>
                    <div style="flex:1"></div>
                    <div class="script-actions">
                        <button id="btnScriptRun">运行脚本</button>
                        <button id="btnScriptStop" disabled>停止运行</button>
                        <button id="btnScriptClose">关闭</button>
                    </div>
                </div>
            </div>
        </dialog>

        <dialog id="dlgScriptName">
            <h4>新建脚本</h4>
            <div style="display:flex;gap:8px;align-items:center;">
                <input id="scriptNameInput" type="text" placeholder="输入名称（无需后缀）" style="flex:1" />
                <span>.js</span>
            </div>
            <div style="margin-top:10px;text-align:right;">
                <button id="scriptNameCancel">取消</button>
                <button id="scriptNameOk">确定</button>
            </div>
        </dialog>
        <dialog id="dlgSettings">
            <div class="dlg">
                <div class="dlg-header">
                    <div class="dlg-title">设置</div>
                    <button class="dlg-close" id="settingsClose">×</button>
                </div>
                <div class="dlg-body">
                    <div class="setting-item">
                        <div class="setting-label">全屏显示(F11)</div>
                        <label class="el-switch">
                            <input type="checkbox" id="fullscreenToggle">
                            <span class="el-switch-core"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">夜间模式</div>
                        <label class="el-switch">
                            <input type="checkbox" id="nightToggle">
                            <span class="el-switch-core"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">惊人的动画</div>
                        <label class="el-switch">
                            <input type="checkbox" id="animToggle">
                            <span class="el-switch-core"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">更惊人的动画</div>
                        <label class="el-switch">
                            <input type="checkbox" id="animExtremeToggle">
                            <span class="el-switch-core"></span>
                        </label>
                    </div>
                </div>
                <div class="dlg-footer">
                    <button id="settingsOk">确定</button>
                </div>
            </div>
        </dialog>


        <script src="./renderer.js"></script>
    </div>
</body>

</html>